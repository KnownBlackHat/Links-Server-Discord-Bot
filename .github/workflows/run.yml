name: Bot Runner

on: [workflow_dispatch]

jobs:
  run:
    runs-on: ubuntu-latest

    steps:
    - name: Run Container
      run: |
        cat >docker-compose.yaml<< EOF \
        version: "3.7" \
        x-restart-policy: &restart_policy \
          restart: unless-stopped \
        services: \
          bot: \
            << : *restart_policy \
            image: ghcr.io/knownblackhat/links-server-discord-bot:latest \
            build: \
              context: . \
              dockerfile: Dockerfile \

            environment: \
              - TOKEN=${{ secrets.token }} \
          EOF
        docker-compose up
